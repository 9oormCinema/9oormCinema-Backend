<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>후기 작성</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const form = document.getElementById('review-form');
          const eventId = new URLSearchParams(window.location.search).get('event_id');

          form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const rating = Number(form.rating.value);
            const comment = form.comment.value;

            try {
              const res = await fetch(`/events/${eventId}/reviews`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  userId: 2,      // 테스트용 userId = 1 고정
                  rating: rating,
                  comment: comment
                })
              });

              if (!res.ok) {
                throw new Error(await res.text());
              }

              const data = await res.json();
              alert('작성 완료: ' + data.review.comment);
            } catch (err) {
              console.error(err);
              alert('후기 작성에 실패했습니다: ' + err.message);
            }
          });
        });
    </script>
</head>
<body>
<h3>후기 작성</h3>
<form id="review-form">
    <label for="rating">별점:</label>
    <select id="rating" name="rating">
        <option value="5">⭐️⭐️⭐️⭐️⭐️</option>
        <option value="4">⭐️⭐️⭐️⭐️</option>
        <option value="3">⭐️⭐️⭐️</option>
        <option value="2">⭐️⭐️</option>
        <option value="1">⭐️</option>
    </select><br/>
    <textarea id="comment" name="comment" placeholder="후기를 입력하세요"></textarea><br/>
    <button type="submit">등록</button>
</form>
</body>
</html>
